## 题干

​	考虑一个南北长 3700m、东西宽 7400m 的矩形场地（图 5），场地中

心点处的射灯距离地面高度 D 为 110 m，地面整体平整，但西深东浅，坡度

α = 1.5°，该型号射灯的开角 θ = 120° 。请设计一组用灯量最节省的射灯布局

布置方案，满足相邻光束之间的重叠率 η 在 10%-20% 范围的要求。



### 分析

​	从题意看，这是一个set covering problem，已被证明为NP-hard问题，无法在多项式时间里得到确切的最优解，应该只能尝试用近似的手段去估算了。

​	最符合直觉的想法是，忽略地面的倾斜度1.5°，我觉得这个忽略是合理的，有两个理由：1.倾斜度比较小，产生的影响有限。2. 也符合实际，现实中不可能专门去测量一下地面倾斜然后针对这个去做灯源配置的优化。

​	简化场景后问题就简化为三维空间顶部的点映射到底部平面，每一个都得到一个大小相等的圆，去推导最小多少个圆可以将底部平面覆盖，在该题干中还有重叠率的范围要求。近似算法可以参考[这篇论文](https://www.elsevier.es/en-revista-journal-applied-research-technology-jart-81-articulo-approximate-packing-circles-in-rectangular-S1665642314700884)

​	这个问题求解可以用cplex去做。具体分析如下：



### 1. 数学模型

1. **变量定义**：
   - 二进制变量 $ {x}_{i,j} $  表示在位置 (i,j) 是否放置一个射灯，其中 i和 j 分别是网格的行和列索引。
2. **目标函数**：
   - 最小化射灯总数：min⁡$ \sum _{ij} {{x}_{i,j}} $ 。
3. **约束条件**：
   - **覆盖约束**：确保每个地面点都至少被一个射灯的光覆盖。
   - **重叠率约束**：相邻光束的重叠区域必须满足10%-20%的要求。
4. **几何考虑**：
   - 射灯投射的光斑是圆形的，其半径取决于射灯的高度和开角。在这里，需要计算这个半径。
5. **模型求解**：
   - 使用CPLEX求解器求解该整数规划问题。

### 2. 几何计算

- 射灯的高度 D=110 米，开角 θ=120°。
- 光斑半径 R 可以通过几何关系计算出来。

### 3. 网格化

- 将区域划分为网格，每个网格代表一个潜在的射灯位置。
- 网格的大小取决于光斑的直径和允许的重叠率。

### 4. 模型构建和求解

- 在CPLEX中构建上述模型。
- 定义目标函数和约束条件。
- 运行CPLEX求解器找到最优解。

### 5. 计算光斑半径

我们需要计算射灯产生的光斑半径。这可以通过以下公式计算：R=D⋅$ \tan {\frac {Θ} {2}} $。

计算这个半径，然后再继续构建模型。

射灯产生的光斑半径大约是 190.53 米。基于此半径，可以进一步计算网格的大小，并构建优化模型。

### 6. 网格大小和布局

- 根据光斑半径和重叠率要求（10%-20%），我们需要确定射灯之间的最优距离。这将影响网格的大小。
- 网格大小通过重叠率来做近似处理
- 先求出重叠面积A的计算公式，d为两原点的距离：

$$
A = 2 \cdot \arccos\left(\frac{d}{2R}\right) \cdot R^2 - \frac{1}{2} \cdot d \cdot \sqrt{4R^2 - d^2}
\
$$



- 射灯少的话应该重叠率最小，即10%，这种情况下A的面积为完整圆面积的10%，然后再反推出d，得到约为306.90米。这里省略了根据A求解d的方法，具体思路和操作是，这个方程是非线性方程，要通过牛顿法或者类似的数值求解算法，可以用python中的fsolve去获得近似解。
- 计算出两圆心的距离后，我们勉强完成了题目条件中有关重叠率率的约束
- 对于场地大小（3700m x 7400m），我们可以基于此距离计算出所需的网格数量。

### 7. 模型求解

- 使用CPLEX求解器求解整数规划问题。
- 找到最小化射灯数量的布局，同时满足覆盖和重叠率的约束，由于我们的网格尺寸是通过重叠率的10%约束得出的，所以代码中只需要添加覆盖约束即可。



## TODO

​	以上的思路还是比较理想，在实际实现中我发现覆盖约束还是比较难定义，而且在网格模型中，是假设射灯在网格的中心，这显然不符合实际，考虑到实际的射灯应该是离散点，需要用连续优化模型，这个暂时还不会。

​	但是在我们定义完网格大小后，其实可以得出一个未经验证但应该是正确的结论：在我们定义的这个网格模型中，每一个网格都需要有射灯（位于网格中心的射灯是无法覆盖到相邻网格的中心的，这个地方有待论证，简单估算了下应该是这样），一共有（3700/306.90）*（7400/306.90）个网格，即需要291（290.696409008向上取整）个均匀分布的射灯。

​	代码中是未完成的想通过cplex添加条件进行求解的代码，覆盖约束不知道如何写。







